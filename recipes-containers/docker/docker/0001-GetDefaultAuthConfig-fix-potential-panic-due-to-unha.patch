From 010a057f828179bcbfc752fcf1c731a05272ba34 Mon Sep 17 00:00:00 2001
From: Sebastiaan van Stijn <github@gone.nl>
Date: Thu, 29 Oct 2020 01:39:30 +0100
Subject: [PATCH 1/3] GetDefaultAuthConfig: fix potential panic due to
 unhandled error

Signed-off-by: Sebastiaan van Stijn <github@gone.nl>
Upstream-commit: f32731f9020f12ae2600a3f4c90e668565220cb6
Component: cli

Upstream-Status: Backport [010a057f828179bcbfc752fcf1c731a05272ba34]
Signed-off-by: Chen Qi <Qi.Chen@windriver.com>
---
 components/cli/cli/command/registry.go | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

diff --git a/components/cli/cli/command/registry.go b/components/cli/cli/command/registry.go
index 161962636e..16165c3998 100644
--- git/src/import/components/cli/cli/command/registry.go
+++ git/src/import/components/cli/cli/command/registry.go
@@ -93,17 +93,18 @@ func GetDefaultAuthConfig(cli Cli, checkCredStore bool, serverAddress string, is
 	if !isDefaultRegistry {
 		serverAddress = registry.ConvertToHostname(serverAddress)
 	}
-	var authconfig configtypes.AuthConfig
+	var authconfig = configtypes.AuthConfig{}
 	var err error
 	if checkCredStore {
 		authconfig, err = cli.ConfigFile().GetAuthConfig(serverAddress)
-	} else {
-		authconfig = configtypes.AuthConfig{}
+		if err != nil {
+			return nil, err
+		}
 	}
 	authconfig.ServerAddress = serverAddress
 	authconfig.IdentityToken = ""
 	res := types.AuthConfig(authconfig)
-	return &res, err
+	return &res, nil
 }
 
 // ConfigureAuth handles prompting of user's username and password if needed
-- 
2.33.0

